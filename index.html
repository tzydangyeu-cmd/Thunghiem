<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>T·∫øt Nguy√™n ƒê√°n 2026 üßß</title>
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        html {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        :root {
            /* c√†nh mai ph·∫£i */
            --mai-size: 60vw;
            --mai-max: 5000px;
            --mai-offset-x: 5px;
            --mai-offset-y: -20px;

            /* c√†nh mai tr√°i */
            --mai-left-size: 40vw;
            --mai-left-max: 5000px;
            --mai-left-offset-x: -5px;
            --mai-left-offset-y: -15px;

            /* t·∫øt */
            --tet-size: 50vw;
            --tet-max: 5000px;
            --tet-offset-x: 0px;
            --tet-offset-y: 0px;

            /* 2026 */
            --haisau-size: 20vw;
            --haisau-max: 5000px;
            --haisau-offset-x: 0px;
            --haisau-offset-y: 0px;

            /* g√≥c tr√°i d∆∞·ªõi*/
            --gtd-size: 110vw;
            --gtd-max: 5000px;
            --gtd-offset-x: -5px;
            --gtd-offset-y: -5px;

            /* g√≥c ph·∫£i d∆∞·ªõi*/
            --dao-size: 25vw;
            --dao-max: 5000px;
            --dao-offset-x: 5px;
            --dao-offset-y: 5px;

            /* b√† v√† c√°c ch√°u */
            --bvcc-size: 100vw;
            --bvcc-max: 5000px;
            --bvcc-offset-x: 0px;
            --bvcc-offset-y: 0px;

            /* l√¢n */
            --lan-size: 80vw;
            --lan-max: 5000px;
            --lan-offset-x: 0px;
            --lan-offset-y: 0px;

            /* üßß t·ªâ l·ªá thi·ªáp */
            --card-width: 50vw;
            --card-max-width: 5000px;
            --card-ratio: 3 / 4;

            /* ‚úçÔ∏è gi·ªõi h·∫°n l·ªùi ch√∫c (% theo thi·ªáp) */
            --text-top: 38%;
            --text-bottom: 35%;
            --text-left: 24%;
            --text-right: 28%;

            /* V·∫≠t r∆°i */
            --lixi-size: clamp(1px, 3vw, 1000px);
            --photo-size: clamp(0px, 5vw, 1000px);
            --icon-size: clamp(1px, 2vw, 1000px);

            /* ‚è±Ô∏è t·ªëc ƒë·ªô r∆°i (c√†ng l·ªõn c√†ng ch·∫≠m) */
            --fall-duration-min: 14s;
            --fall-duration-max: 22s;
        }

        body {
            margin: 0;
            overflow: hidden;
            background: black;
            font-family: Arial, sans-serif;
            text-align: center;
            transition: background 2.5s ease;
        }

        #rotateScreen {
            position: fixed;
            inset: 0;
            background: black;
            color: white;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .rotate-box {
            font-size: 20px;
            text-align: center;
        }

        #startBtn {
            padding: 18px 40px;
            font-size: 22px;
            border: none;
            border-radius: 40px;
            background: linear-gradient(45deg, #ff5252, #ffb300);
            color: white;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(255, 200, 0, 0.8);
        }

        @font-face {
            font-family: "TetFont";
            src: url("https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/202e0674ff4858d19e9c4d18cee0314c30a7529d/SVN-Dancing-script.ttf") format("truetype");
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: "ThuongFont";
            src: url("https://cdn.jsdelivr.net/gh/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan@main/SVN-Freude.ttf") format("truetype");
            /*link CDN*/
            font-weight: normal;
            font-style: normal;
        }

        #rotateScreen {
            position: fixed;
            inset: 0;
            background: black;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        #phoneIcon {
            width: 100px;
            margin-bottom: 40px;
            opacity: 0;
            animation: phoneAnim 1.8s linear infinite;
            filter: drop-shadow(0 0 12px white);
        }

        .rotateText {
            font-family: "TetFont", cursive;
            font-size: 30px;
            color: white;
            text-align: center;
            text-shadow:
                0 0 5px #fff,
                0 0 15px #fff,
                0 0 30px rgba(255, 255, 255, 0.9);

            animation: glowText 2s ease-in-out infinite alternate;
        }

        @keyframes phoneAnim {
            0% {
                opacity: 0;
                transform: rotate(0deg);
            }

            20% {
                opacity: 1;
            }

            80% {
                opacity: 1;
                transform: rotate(-90deg);
            }

            100% {
                opacity: 0;
                transform: rotate(-90deg);
            }
        }

        @keyframes glowText {
            from {
                text-shadow:
                    0 0 5px #fff,
                    0 0 15px #fff;
            }

            to {
                text-shadow:
                    0 0 10px #fff,
                    0 0 25px #fff,
                    0 0 40px rgba(255, 255, 255, 1);
            }
        }

        @keyframes swayBranch {
            0% {
                transform: rotate(0deg);
            }

            25% {
                transform: rotate(0.8deg);
            }

            50% {
                transform: rotate(0deg);
            }

            75% {
                transform: rotate(-0.8deg);
            }

            100% {
                transform: rotate(0deg);
            }
        }

        @keyframes floatText {
            0% {
                transform: translate(0, 0);
            }

            25% {
                transform: translate(2px, -3px);
            }

            50% {
                transform: translate(0, -1px);
            }

            75% {
                transform: translate(-2px, -3px);
            }

            100% {
                transform: translate(0, 0);
            }
        }

        #introScreen {
            position: fixed;
            inset: 0;
            background: black;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 20;
        }

        #introBox {
            padding: 40px 60px;
            border: 2px solid white;
            opacity: 0;
            box-shadow: 0 0 20px white;
            transition: opacity 1.5s ease;
            position: relative;
        }

        #introText {
            font-family: "TetFont", cursive;
            font-size: 38px;
            color: white;
            text-align: center;
            white-space: pre-line;
            text-shadow:
                0 0 5px #fff,
                0 0 15px #fff,
                0 0 30px rgba(255, 255, 255, 0.9);
        }

        #tapHint {
            position: absolute;
            bottom: -28px;
            right: 0;
            font-size: 14px;
            color: white;
            font-family: "TetFont", cursive;
            letter-spacing: 0.5px;
            text-decoration: underline;
            text-underline-offset: 4px;
        }

        #loadingScreen {
            position: fixed;
            inset: 0;
            background: black;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 30;
        }

        .loadingText {
            font-family: "TetFont", cursive;
            font-size: 28px;
            color: white;
            text-shadow:
                0 0 5px #fff,
                0 0 15px #fff,
                0 0 30px rgba(255, 255, 255, 0.9);
            animation: glowText 2s ease-in-out infinite alternate;
        }

        .loadingBox {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 18px;
        }

        .progressBar {
            width: 280px;
            height: 8px;
            border: 1px solid white;
            box-shadow: 0 0 10px white;
            overflow: hidden;
        }

        .progressFill {
            width: 0%;
            height: 100%;
            background: white;
            box-shadow: 0 0 15px white;
            transition: width 0.3s ease;
        }

        .progressPercent {
            font-family: "TetFont", cursive;
            font-size: 18px;
            color: white;
        }

        #loadingScreen {
            transition: opacity 1.2s ease;
        }

        #fullscreenBtn {
            position: fixed;
            top: 12px;
            right: 12px;
            z-index: 99999;

            width: 30px;
            height: 30px;

            font-size: 20px;
            line-height: 1;

            display: flex;
            align-items: center;
            justify-content: center;

            color: black;
            background: rgba(0, 0, 0, 0);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;

            cursor: pointer;
            backdrop-filter: blur(6px);
        }

        #fullscreenBtn:active {
            transform: scale(0.95);
        }

        #mai-anchor {
            position: fixed;
            top: 0;
            right: 0;

            transform: translate(var(--mai-offset-x), var(--mai-offset-y));
            pointer-events: none;
            z-index: 2;
        }

        #mai-branch {
            width: clamp(180px, var(--mai-size), var(--mai-max));
            aspect-ratio: 1 / 1;

            background-image: url("https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/canh_cay_phai.png");
            background-repeat: no-repeat;
            background-size: contain;
            background-position: top right;

            transform-origin: top right;

            opacity: 0;
            transform: translateX(120px);

            transition:
                opacity 2s ease,
                transform 2s ease;
        }

        #mai-left-anchor {
            position: fixed;
            top: 0;
            left: 0;

            transform: translate(var(--mai-left-offset-x),
                    var(--mai-left-offset-y));

            pointer-events: none;
            z-index: 2;
        }

        #mai-left-branch {
            width: clamp(180px, var(--mai-left-size), var(--mai-left-max));
            aspect-ratio: 1 / 1;

            background-image: url("https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/canh_cay_trai.png");
            background-repeat: no-repeat;
            background-size: contain;
            background-position: top left;

            transform-origin: top left;

            opacity: 0;
            transform: translateX(-120px);

            transition:
                opacity 2s ease,
                transform 2s ease;
        }

        #tet-text-anchor {
            position: fixed;
            top: 50%;
            left: 50%;

            transform: translate(calc(-50% + var(--tet-offset-x)),
                    calc(-50% + var(--tet-offset-y)));

            pointer-events: none;
            z-index: 3;
        }

        #haisau-text-anchor {
            position: fixed;
            top: 80%;
            left: 50%;

            transform: translate(calc(-50% + var(--haisau-offset-x)),
                    calc(-50% + var(--haisau-offset-y)));

            pointer-events: none;
            z-index: 3;
        }

        #tet-text {
            width: clamp(180px, var(--tet-size), var(--tet-max));
            aspect-ratio: 3 / 1;
            /* ch·ªânh n·∫øu ·∫£nh kh√°c */

            background-image: url("https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/tet.png");
            background-repeat: no-repeat;
            background-size: contain;
            background-position: center;

            opacity: 0;
            transform: scale(0.95);

            transition:
                opacity 2s ease,
                transform 2s ease;
        }

        #haisau-text {
            width: clamp(180px, var(--haisau-size), var(--haisau-max));
            aspect-ratio: 1 / 1;
            /* ch·ªânh n·∫øu ·∫£nh kh√°c */

            background-image: url("https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/haisau.png");
            background-repeat: no-repeat;
            background-size: contain;
            background-position: center;

            opacity: 0;
            transform: scale(0.95);

            transition:
                opacity 2s ease,
                transform 2s ease;
        }

        #gtd-anchor {
            position: fixed;
            left: 0;
            bottom: 0;

            transform: translate(var(--gtd-offset-x),
                    calc(-1 * var(--gtd-offset-y)));

            pointer-events: none;
            z-index: 3;
        }

        #gtd {
            width: clamp(180px, var(--gtd-size), var(--gtd-max));
            aspect-ratio: 5 / 1;
            /* ch·ªânh n·∫øu ·∫£nh kh√°c */

            background-image: url("https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/goc_trai_duoi.png");
            background-repeat: no-repeat;
            background-size: contain;
            background-position: bottom left;
            transform-origin: bottom left;

            opacity: 0;
            transform: translateX(-120px);

            transition:
                opacity 2s ease,
                transform 2s ease;
        }

        #dao-anchor {
            position: fixed;
            right: 0;
            bottom: 0;

            transform: translate(var(--dao-offset-x),
                    var(--dao-offset-y));

            pointer-events: none;
            z-index: 2;
        }

        #dao-branch {
            width: clamp(180px, var(--dao-size), var(--dao-max));
            aspect-ratio: 1 / 1;

            background-image: url("https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/goc_phai_duoi.png");
            background-repeat: no-repeat;
            background-size: contain;
            background-position: bottom right;

            transform-origin: bottom right;

            opacity: 0;
            transform: translateX(120px);

            transition:
                opacity 2s ease,
                transform 2s ease;
        }

        #bvcc-anchor {
            position: fixed;
            top: 70%;
            left: 23%;

            transform: translate(calc(-50% + var(--bvcc-offset-x)),
                    calc(-55% + var(--bvcc-offset-y)));

            pointer-events: none;
            z-index: 3;
        }

        #bvcc {
            width: clamp(180px, var(--bvcc-size), var(--bvcc-max));
            aspect-ratio: 6 / 1;
            /* ch·ªânh n·∫øu ·∫£nh kh√°c */

            background-image: url("https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/bvcc.png");
            background-repeat: no-repeat;
            background-size: contain;
            background-position: center;

            opacity: 0;
            transform: scale(0.95);

            transition:
                opacity 2s ease,
                transform 2s ease;
        }

        #lan-anchor {
            position: fixed;
            top: 60%;
            left: 70%;

            transform: translate(calc(-50% + var(--lan-offset-x)),
                    calc(-50% + var(--lan-offset-y)));

            pointer-events: none;
            z-index: 3;
        }

        #lan {
            width: clamp(180px, var(--lan-size), var(--lan-max));
            aspect-ratio: 3 / 1;
            /* ch·ªânh n·∫øu ·∫£nh kh√°c */

            background-image: url("https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/lan.png");
            background-repeat: no-repeat;
            background-size: contain;
            background-position: center;

            opacity: 0;
            transform: scale(0.95);

            transition:
                opacity 2s ease,
                transform 2s ease;
        }

        .leaf {
            position: fixed;
            top: -60px;

            background-size: contain;
            background-repeat: no-repeat;
            pointer-events: none;

            z-index: 1;
            opacity: 0.9;
        }

        #card-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.45);

            opacity: 0;
            pointer-events: none;

            transition: opacity 1.2s ease;
            z-index: 10;
        }


        #card-anchor {
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -40%);
            transition: opacity 1s ease, transform 1s ease;
            opacity: 0;
            z-index: 999;
        }

        #card {
            width: clamp(260px, var(--card-width), var(--card-max-width));
            aspect-ratio: var(--card-ratio);

            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;

            position: relative;
            opacity: 0;
            transform: translateY(20px);
            transition:
                opacity 1.2s ease,
                transform 1.2s ease;
        }

        #card-text-box {
            position: absolute;
            top: var(--text-top);
            bottom: var(--text-bottom);
            left: var(--text-left);
            right: var(--text-right);

            overflow-y: auto;
            /* ‚úÖ cho cu·ªôn d·ªçc */
            overflow-x: hidden;

            scrollbar-width: none;
            /* Firefox */
            -ms-overflow-style: none;
            /* IE, Edge c≈© */
        }

        #card-text-box::-webkit-scrollbar {
            display: none;
        }

        #card-text {
            font-family: "TetFont", "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", cursive;
            /* ‚úÖ font iro */
            font-size: 1em;
            line-height: 1.55;
            color: #5a2a0c;
            white-space: pre-wrap;
        }

        #card-close {
            position: absolute;
            top: 24%;
            /* ‚¨Ö c√°ch m√©p tr√™n */
            right: 0;
            /* ‚¨Ö c√°ch m√©p ph·∫£i */
            transform: translate(-12px, 12px);

            width: 36px;
            /* ‚¨Ö vu√¥ng l·ªõn h∆°n ch·ªØ X */
            height: 36px;

            display: flex;
            align-items: center;
            justify-content: center;

            background: #ffd2c2;
            /* üé® n·ªÅn */
            border: 5px solid #761413;
            /* üé® vi·ªÅn */
            border-radius: 8px;
            /* bo g√≥c m·ªÅm */

            color: #761413;
            font-size: 20px;
            font-weight: bold;

            cursor: pointer;
            z-index: 10;

            transition: transform 0.2s ease, background 0.2s ease;
        }

        #card-close:hover {
            background: #ffbeab;
            transform: translate(-12px, 12px) scale(1.08);
        }

        /* üîÅ n√∫t m·ªü l·∫°i thi·ªáp */
        #reopen-card-btn {
            position: fixed;
            top: 16px;
            left: 16px;

            opacity: 0;
            pointer-events: none;

            transition: opacity 0.8s ease;
            z-index: 1000;
        }

        #reopen-card-btn img {
            width: 48px;
            /* ‚≠ê ch·ªânh k√≠ch th∆∞·ªõc icon t·∫°i ƒë√¢y */
            height: auto;
            cursor: pointer;
            filter: drop-shadow(0 0 6px rgba(0, 0, 0, 0.3));
        }

        #reopen-card-btn.show {
            opacity: 1;
            pointer-events: auto;
        }

        .fall-item {
            position: fixed;
            top: -120px;
            pointer-events: none;
            z-index: 4;

            animation-name: fallDown, sway;
            animation-timing-function: linear, ease-in-out;
            animation-iteration-count: infinite, infinite;
        }

        @keyframes fallDown {
            from {
                transform: translateY(-120px);
            }

            to {
                transform: translateY(calc(100vh + 140px));
            }
        }

        @keyframes sway {
            0% {
                margin-left: 0;
            }

            50% {
                margin-left: 20px;
            }

            100% {
                margin-left: 0;
            }
        }

        /* üßß bao l√¨ x√¨ wrapper */
        .fall-lixi {
            width: var(--lixi-size);
            /* height s·∫Ω ƒë∆∞·ª£c JS t√≠nh to√°n ƒë·ªông */
            pointer-events: auto !important;
            z-index: 6;
        }

        /* üßß inner xoay - c·∫•u tr√∫c c≈© */
        .lixi-spin {
            width: 100%;
            height: 100%;
            background-size: 101% 101%;
            /* Tr√°nh h·ªü vi·ªÅn tr·∫Øng khi xoay */
            background-repeat: no-repeat;
            background-position: center;
            animation-name: spin;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }

        /* üñºÔ∏è ·∫£nh r∆°i photo */
        .fall-photo {
            width: var(--photo-size, 800px);
            height: var(--photo-size, 800px);
            background-size: cover;
            background-position: center;
            /* CH·ªàNH M√ÄU VI·ªÄN T·∫†I ƒê√ÇY: 2px, n√©t li·ªÅn, m√†u tr·∫Øng */
            border: 2px solid #000000 !important;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0);
            border-radius: 0px;
            cursor: pointer;
            z-index: 4;
            box-sizing: border-box;
            /* ƒê·∫£m b·∫£o vi·ªÅn kh√¥ng l√†m tƒÉng k√≠ch th∆∞·ªõc ·∫£nh */
        }



        /* üå∏ icon t·∫øt b·∫±ng emoji */
        .fall-emoji {
            position: fixed;
            top: -80px;
            pointer-events: none;
            z-index: 4;

            animation-name: fallDown, sway;
            animation-timing-function: linear, ease-in-out;
            animation-iteration-count: infinite, infinite;
        }

        .emoji-spin {
            font-size: var(--icon-size);
            line-height: 1;

            animation-name: spin;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        /* üßß wrapper r∆°i */
        .fall-lixi {
            position: fixed;
            top: -120px;
            left: 0;
            /*?????*/
            pointer-events: auto !important;
            z-index: 6;

            width: var(--lixi-size, 80px);
            height: var(--lixi-size, 80px);

            animation-name: fallDown, sway;
            animation-timing-function: linear, ease-in-out;
            animation-iteration-count: infinite, infinite;
        }


        .lixi-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.45);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            transition: opacity 0.35s ease;
        }

        .lixi-popup {
            position: relative;
            width: 320px;
            height: 220px;
            background: transparent;
            transform: scale(0.8);
            transition: transform 0.35s ease;
        }

        .lixi-overlay.show .lixi-popup {
            transform: scale(1);
        }

        /* üßß bao l√¨ x√¨ ‚Äì ph√≠a sau */
        .popup-lixi {
            position: absolute;
            inset: 0;
            margin: auto;
            max-width: 100%;
            max-height: 100%;
            transform: rotate(90deg);
            z-index: 1;
            border-radius: 14px;
        }

        /* T·ªù ti·ªÅn ‚Äì ph√≠a tr∆∞·ªõc */
        .popup-money {
            position: absolute;
            inset: 0;
            margin: auto;
            max-width: 90%;
            max-height: 90%;
            z-index: 2;
            border-radius: 12px;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
            /* Xoay ng∆∞·ª£c chi·ªÅu kim ƒë·ªìng h·ªì 90 ƒë·ªô */
            transform: rotate(0deg);
        }


        .lixi-popup img {
            max-width: 80vw;
            max-height: 60vh;
            transform: rotate(-90deg);
            /* üßß xoay ngang */
            border-radius: 12px;
        }

        /* N√∫t ƒë√≥ng cho popup l√¨ x√¨ */
        .lixi-close {
            position: absolute;
            top: -15px;
            right: -15px;
            width: 35px;
            height: 35px;
            background: #fff;
            border: 2px solid #761413;
            border-radius: 50%;
            color: #761413;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            z-index: 100;
            /* Lu√¥n n·∫±m tr√™n c√πng */
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .lixi-close:hover {
            background: #eee;
            transform: scale(1.1);
        }

        /* Hi·ªáu ·ª©ng l·∫Øc c·ª±c m·∫°nh nh∆∞ng kh√¥ng l√†m m·ªù bao l√¨ x√¨ */
        @keyframes superVibrate {
            0% {
                transform: rotate(0deg) scale(1);
            }

            /* Giai ƒëo·∫°n ƒë·∫ßu: Rung nh·∫π nh√†ng */
            10% {
                transform: rotate(-1deg) scale(1.05);
            }

            20% {
                transform: rotate(1deg) scale(1.1);
            }

            /* Giai ƒëo·∫°n gi·ªØa: Rung nhanh d·∫ßn */
            30% {
                transform: rotate(-3deg) scale(1.15);
            }

            45% {
                transform: rotate(3deg) scale(1.2);
            }

            /* Giai ƒëo·∫°n cu·ªëi: Rung c·ª±c ƒë·∫°i (Vibrate Mode) */
            55% {
                transform: rotate(-5deg) scale(1.25);
            }

            65% {
                transform: rotate(5deg) scale(1.3);
            }

            75% {
                transform: rotate(-10deg) scale(1.35);
            }

            85% {
                transform: rotate(10deg) scale(1.37);
            }

            87.5% {
                transform: rotate(-10deg) scale(1.4);
            }

            90% {
                transform: rotate(10deg) scale(1.425);
            }

            92.5% {
                transform: rotate(-10deg) scale(1.45);
            }

            95% {
                transform: rotate(10deg) scale(1.47);
            }

            97.5% {
                transform: rotate(-10deg) scale(1.5);
            }

            100% {
                transform: rotate(0deg) scale(1.5);
                opacity: 1;
            }
        }



        /* L·ªõp m√†n tr·∫Øng ph·ªß to√†n di·ªán */
        .flash-white {
            position: fixed;
            inset: 0;
            background: #ffffff;
            z-index: 99999;
            /* Cao nh·∫•t ƒë·ªÉ ƒë√® l√™n m·ªçi th·ª© */
            opacity: 0;
            pointer-events: none;
        }

        .flash-active {
            animation: flashStep 1s ease-out forwards;
        }

        @keyframes flashStep {
            0% {
                opacity: 0;
            }

            20% {
                opacity: 1;
            }

            /* ƒê·∫°t ƒë·ªânh tr·∫Øng x√≥a */
            100% {
                opacity: 0;
            }

            /* M·ªù d·∫ßn ƒë·ªÉ l·ªô ti·ªÅn ph√≠a sau */
        }

        /* D√≤ng ch·ªØ h∆∞·ªõng d·∫´n cu·ªëi c√πng */
        .tap-hint {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-size: 13px;
            z-index: 10001;
            opacity: 0;
            text-shadow: 0 0 8px rgba(0, 0, 0, 0.8);
            font-family: "ThuongFont", cursive;
            pointer-events: none;
            opacity: 0;
            /* B·∫Øt ƒë·∫ßu l√† ·∫©n ho√†n to√†n */
            transition: opacity 0.5s ease-in-out;
            /* Th·ªùi gian m·ªù sang s√°ng (1.5 gi√¢y) */
        }

        .photo-himt {
            position: fixed;
            bottom: 50%;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-size: 13px;
            z-index: 10001;
            opacity: 0;
            text-shadow: 0 0 8px rgba(0, 0, 0, 0.8);
            font-family: "ThuongFont", cursive;
            pointer-events: none;
            opacity: 0;
            /* B·∫Øt ƒë·∫ßu l√† ·∫©n ho√†n to√†n */
            transition: opacity 0.5s ease-in-out;
            /* Th·ªùi gian m·ªù sang s√°ng (1.5 gi√¢y) */
        }

        /* L·ªõp ƒë·ªÉ ph√≥ng to ·∫£nh l√™n gi·ªØa m√†n h√¨nh */
        .fall-photo.viewing {
            position: fixed !important;
            z-index: 100002 !important;
            border: 2px solid #000000 !important;
            /* Gi·ªØ vi·ªÅn tr·∫Øng khi ph√≥ng to */
            outline: none !important;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0);
            transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
        }

        /* Overlay t·ªëi n·ªÅn d√πng chung v·ªõi lixi ho·∫∑c t·∫°o ri√™ng */
        #photo-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10001;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }

        #photo-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        /* Container ch·ª©a ch·ªØ b√™n ph·∫£i ·∫£nh */
        #photo-caption-box {
            position: fixed;
            top: 50%;
            left: 65%;
            transform: translate(-50%, -50%);
            width: 35vw;
            color: #fff;
            text-align: left;
            z-index: 100003;
            pointer-events: none;
            font-family: "ThuongFont", cursive;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        #photo-caption-box.show {
            opacity: 1;
        }

        /*
        #photo-caption-box h3 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #ffb300;
        }
*/
        #photo-caption-box p {
            font-size: 1.5em;
            line-height: 1.4;
        }

        /* Hi·ªáu ·ª©ng xu·∫•t hi·ªán cho t·ª´ng th√†nh ph·∫ßn */
        #caption-title,
        #caption-text {
            opacity: 0;
            filter: blur(10px);
            transform: translateY(20px);
            transition: all 1s cubic-bezier(0.22, 1, 0.36, 1);
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
        }

        /* Khi c√≥ class .show-text th√¨ ch·ªØ m·ªõi hi·ªán l√™n */
        #photo-caption-box.active #caption-title {
            opacity: 1;
            filter: blur(0);
            transform: translateY(0);
            transition-delay: 0.3s;
            /* Ti√™u ƒë·ªÅ hi·ªán tr∆∞·ªõc */
        }

        #photo-caption-box.active #caption-text {
            opacity: 1;
            filter: blur(0);
            transform: translateY(0);
            transition-delay: 0.6s;
            /* N·ªôi dung hi·ªán sau */
        }

        /* Hi·ªáu ·ª©ng m·ªù d·∫ßn khi ƒë√≥ng */
        #photo-caption-box.fading {
            opacity: 0;
            transition: opacity 0.5s ease;
        }
    </style>

</head>


<body>

    <div id="photo-caption-box">
        <p id="caption-text"></p>
    </div>

    <div id="photo-hint" style="
    position: fixed;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    color: white;
    font-family: 'ThuongFont', cursive;
    font-size: 13px;
    text-shadow: 0px 0px 0px rgba(0,0,0,0);
    opacity: 0;
    transition: opacity 1.5s ease;
    z-index: 100005;
    pointer-events: none;
    white-space: nowrap;
">
        * Nh·∫•n v√†o m√†n h√¨nh ƒë·ªÉ ti·∫øp t·ª•c *
    </div>

    <div id="photo-overlay"></div>

    <div class="fall-lixi">
        <div class="lixi-spin"></div>
    </div>

    <div id="lan-anchor">
        <div id="lan"></div>
    </div>

    <div id="bvcc-anchor">
        <div id="bvcc"></div>
    </div>

    <div id="dao-anchor">
        <div id="dao-branch"></div>
    </div>

    <div id="gtd-anchor">
        <div id="gtd"></div>
    </div>

    <div id="tet-text-anchor">
        <div id="tet-text"></div>
    </div>

    <div id="haisau-text-anchor">
        <div id="haisau-text"></div>
    </div>

    <div id="mai-anchor">
        <div id="mai-branch"></div>
    </div>

    <div id="mai-left-anchor">
        <div id="mai-left-branch"></div>
    </div>

    <div id="rotateScreen">
        <img id="phoneIcon"
            src="https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/phone.png"
            alt="Rotate phone" />
        <div class="rotateText">Vui l√≤ng xoay ngang m√†n h√¨nh</div>
    </div>

    <div id="introScreen">
        <div id="introBox">
            <div id="introText"></div>
            <div id="tapHint"></div>
        </div>
    </div>

    <div id="loadingScreen">
        <div class="loadingBox">
            <div class="loadingText">Loading...</div>

            <div class="progressBar">
                <div class="progressFill"></div>
            </div>

            <div class="progressPercent">0%</div>
        </div>
    </div>

    <canvas id="fireworks"></canvas>
    <script>
        const canvas = document.getElementById("fireworks");
        const ctx = canvas.getContext("2d");
        const rotateScreen = document.getElementById("rotateScreen");
        let started = false;

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.addEventListener("resize", resize);

        function preloadMoneyImages() {
            console.log("ƒêang t·∫£i tr∆∞·ªõc ·∫£nh ti·ªÅn theo t·ªâ l·ªá...");
            moneyWeights.forEach((item) => {
                const img = new Image();
                img.src = item.url;
            });
        }


        function checkOrientation() {
            const isMobile = /Android|iPhone|iPad/i.test(navigator.userAgent);

            if (!isMobile) {
                rotateScreen.style.display = "none";
                startIntro();
                return true;
            }

            if (window.innerHeight > window.innerWidth) {
                rotateScreen.style.display = "flex";
                return false;
            }

            rotateScreen.style.display = "none";
            startIntro();
            return true;
        }

        window.addEventListener("resize", checkOrientation);
        window.addEventListener("orientationchange", checkOrientation);

        checkOrientation();
    </script>
    <script>
        function enterFullscreen() {
            const el = document.documentElement;
            if (el.requestFullscreen) {
                el.requestFullscreen();
            } else if (el.webkitRequestFullscreen) {
                el.webkitRequestFullscreen(); // Safari
            }
        }
    </script>

    <script>
        let audioCtx;
        let bgBuffer;
        let bgSource;

        async function initAudio() {
            try {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();

                if (audioCtx.state === "suspended") {
                    await audioCtx.resume();
                }

                const files = [

                    { name: "bg", url: "audio/bg.mp3" },
                ];

                let totalBytes = 0;
                let loadedBytes = 0;

                for (const file of files) {
                    const res = await fetch(file.url, { method: "HEAD" });
                    const size = res.headers.get("Content-Length");
                    totalBytes += Number(size);
                }

                function updateProgress() {
                    const percent = Math.min(
                        100,
                        Math.floor((loadedBytes / totalBytes) * 100)
                    );
                    progressFill.style.width = percent + "%";
                    progressPercent.textContent = percent + "%";
                }

                for (const file of files) {
                    const response = await fetch(file.url);
                    const reader = response.body.getReader();
                    let chunks = [];
                    let received = 0;

                    while (true) {
                        const { done, value } = await reader.read();
                        if (done) break;
                        chunks.push(value);
                        received += value.length;
                        loadedBytes += value.length;
                        updateProgress();
                    }

                    const audioBuffer = await audioCtx.decodeAudioData(
                        mergeChunks(chunks, received)
                    );
                    if (file.name === "bg") bgBuffer = audioBuffer;
                }

                updateProgress();
                console.log("All audio loaded with real progress");

            } catch (err) {
                console.error("Audio load error:", err);
                alert("Kh√¥ng t·∫£i ƒë∆∞·ª£c √¢m thanh üò•");
            }
        }

        function mergeChunks(chunks, totalLength) {
            const buffer = new Uint8Array(totalLength);
            let offset = 0;

            for (const chunk of chunks) {
                buffer.set(chunk, offset);
                offset += chunk.length;
            }

            return buffer.buffer;
        }

        function playBG() {
            if (!bgBuffer || !audioCtx) return;
            bgSource = audioCtx.createBufferSource();
            bgSource.buffer = bgBuffer;
            bgSource.loop = true;
            const gainNode = audioCtx.createGain();
            gainNode.gain.value = 0.4; // volume √¢m thanh n·ªÅn
            bgSource.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            bgSource.start(0);
        }

        const LEAF_CONFIG = {
            maxLeaves: 60,        // üçÉ s·ªë l√° t·ªëi ƒëa tr√™n m√†n h√¨nh
            fallSpeed: 1,         // ‚è±Ô∏è t·ªëc ƒë·ªô r∆°i (px/frame)
            rotateSpeed: 0.5,     // üîÑ t·ªëc ƒë·ªô xoay (ƒë·ªô / frame)
            tiltAngle: 45,
            leafSize: 80,         // üçÉ K√çCH C·ª† L√Å
            fallAngle: -45         // üçÉ G√ìC R∆†I
        };

        const maiLeaves = [
            "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/la1.png",
            "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/la2.png",
            "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/la3.png",
            "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/la4.png",
            "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/la5.png",
            "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/la6.png",
            "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/la7.png",
            "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/la8.png",
            "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/la9.png"
        ];

        function createLeaf() {
            if (document.querySelectorAll(".leaf").length >= LEAF_CONFIG.maxLeaves) {
                return;
            }

            const leaf = document.createElement("div");
            leaf.className = "leaf";

            leaf.style.width = `${LEAF_CONFIG.leafSize}px`;
            leaf.style.height = `${LEAF_CONFIG.leafSize}px`;

            // üé≤ ch·ªçn ·∫£nh l√° ng·∫´u nhi√™n
            const img = maiLeaves[Math.floor(Math.random() * maiLeaves.length)];
            leaf.style.backgroundImage = `url(${img})`;

            // üéØ x√°c ƒë·ªãnh v√πng r∆°i
            const screenWidth = window.innerWidth;
            const rand = Math.random();

            let startX;

            if (rand < 0.25) {
                // 25% b√™n tr√°i
                startX = Math.random() * screenWidth * 0.25;
            } else if (rand > 0.6) {
                // 40% b√™n ph·∫£i
                startX = screenWidth * 0.6 + Math.random() * screenWidth * 0.4;
            } else {
                // ‚ùå v√πng gi·ªØa kh√¥ng r∆°i
                return;
            }

            let x = startX;
            let y = -50;

            let rotation = 0;

            // üéØ t√≠nh vector r∆°i theo g√≥c
            const angleRad = LEAF_CONFIG.fallAngle * Math.PI / 180;
            const speedX = Math.sin(angleRad) * LEAF_CONFIG.fallSpeed;
            const speedY = Math.cos(angleRad) * LEAF_CONFIG.fallSpeed;

            leaf.style.left = `${startX}px`;
            leaf.style.transform = `rotate(${rotation}deg)`;

            document.body.appendChild(leaf);

            // üå¨Ô∏è animation r∆°i
            function fall() {
                x += speedX;
                y += speedY;
                rotation += LEAF_CONFIG.rotateSpeed;

                leaf.style.left = `${x}px`;
                leaf.style.top = `${y}px`;
                leaf.style.transform = `rotate(${rotation}deg)`;

                if (y < window.innerHeight + 60) {
                    requestAnimationFrame(fall);
                } else {
                    leaf.remove();
                }
            }

            requestAnimationFrame(fall);
        }
    </script>

    <script>
        const progressFill = document.querySelector(".progressFill");
        const progressPercent = document.querySelector(".progressPercent");
        const loadingScreen = document.getElementById("loadingScreen");
        const introScreen = document.getElementById("introScreen");
        const introBox = document.getElementById("introBox");
        const introText = document.getElementById("introText");
        const tapHint = document.getElementById("tapHint");
        const mainText = "M l·∫° g√¨ c√°i n√†y n·ªØa\nƒê√∫ng kh√¥ng ü§£ü§£ü§£"; // intro ƒë·∫ßuq
        const hintText = "Nh·∫•n v√†o m√†ng h√¨nh";
        const music = new Audio("https://raw.githubusercontent.com/tzydangyeu-cmd/Nam_moi_cho_em/main/sounds/bg.mp3");
        let textIndex = 0;
        let hintIndex = 0;
        let introDone = false;

        function typeMainText() {
            if (textIndex < mainText.length) {
                introText.textContent += mainText.charAt(textIndex);
                textIndex++;
                setTimeout(typeMainText, 60);
            } else {
                setTimeout(typeHintText, 500);
            }
        }

        function typeHintText() {
            if (hintIndex < hintText.length) {
                tapHint.textContent += hintText.charAt(hintIndex);
                hintIndex++;
                setTimeout(typeHintText, 80);
            } else {
                introDone = true;
            }
        }

        let introStarted = false;

        function startIntro() {
            if (introStarted) return;
            introStarted = true;
            introScreen.style.display = "flex";
            introText.textContent = "";
            tapHint.textContent = "";
            introBox.style.opacity = 1;
            setTimeout(typeMainText, 800);
        }

        introScreen.addEventListener("click", async () => {
            if (!introDone) return;
            enterFullscreen();
            loadCardImage(); // üëà b·∫Øt ƒë·∫ßu load thi·ªáp sau c√∫ ch·∫°m
            preloadMoneyImages();
            introScreen.style.transition = "opacity 1.5s ease";
            introScreen.style.opacity = 0;
            setTimeout(async () => {
                introScreen.remove();
                loadingScreen.style.display = "flex";
                await initAudio();
                setTimeout(() => {
                    loadingScreen.style.opacity = 0;
                    setTimeout(() => {
                        loadingScreen.remove();
                        document.body.style.background = "#fffde4";

                        // icon r∆°i
                        setTimeout(() => {
                            startFallingEffect();
                        }, 0);

                        // c√†nh ph·∫£i--
                        const branch = document.getElementById("mai-branch");
                        setTimeout(() => {
                            branch.style.opacity = 1;
                            branch.style.transform = "translateX(0)";

                            setTimeout(() => {
                                branch.style.animation = "swayBranch 6s ease-in-out infinite";
                            }, 2000);
                        }, 1500);
                        //end

                        // c√†nh tr√°i --
                        const leftBranch = document.getElementById("mai-left-branch");
                        setTimeout(() => {
                            leftBranch.style.opacity = 1;
                            leftBranch.style.transform = "translateX(0)";

                            setTimeout(() => {
                                leftBranch.style.animation = "swayBranch 6s ease-in-out infinite";
                            }, 2000);
                        }, 1500);
                        // end

                        // t·∫øt
                        const tetText = document.getElementById("tet-text");
                        setTimeout(() => {
                            tetText.style.opacity = 1;
                            tetText.style.transform = "scale(1)";

                            setTimeout(() => {
                                tetText.style.animation = "floatText 6s ease-in-out infinite";
                            }, 2000);
                        }, 1500);
                        // end

                        // 2026
                        const haisauText = document.getElementById("haisau-text");
                        setTimeout(() => {
                            haisauText.style.opacity = 1;
                            haisauText.style.transform = "scale(1)";

                            setTimeout(() => {
                                haisauText.style.animation = "floatText 6s ease-in-out infinite";
                            }, 2500);
                        }, 1500);
                        // end

                        // g√≥c tr√°i d∆∞·ªõi 
                        const gtd = document.getElementById("gtd");
                        setTimeout(() => {
                            gtd.style.opacity = 1;
                            gtd.style.transform = "translateX(0)";

                            setTimeout(() => {
                                gtd.style.animation = "swayBranch 6s ease-in-out infinite";
                            }, 1500);
                        }, 1500);
                        // end

                        // g√≥c ph·∫£i d∆∞·ªõi 
                        const daoBranch = document.getElementById("dao-branch");
                        setTimeout(() => {
                            daoBranch.style.opacity = 1;
                            daoBranch.style.transform = "translateX(0)";

                            setTimeout(() => {
                                daoBranch.style.animation = "swayBranch 6s ease-in-out infinite";
                            }, 2000);
                        }, 1500);
                        // end

                        // b√† v√† c√°c ch√°u
                        const bvcc = document.getElementById("bvcc");
                        setTimeout(() => {
                            bvcc.style.opacity = 1;
                            bvcc.style.transform = "scale(1)";

                            setTimeout(() => {
                                bvcc.style.animation = "floatText 6s ease-in-out infinite";
                            }, 2000);
                        }, 1500);
                        // end

                        // l√¢n
                        const lan = document.getElementById("lan");
                        setTimeout(() => {
                            lan.style.opacity = 1;
                            lan.style.transform = "scale(1)";

                            setTimeout(() => {
                                lan.style.animation = "floatText 6s ease-in-out infinite";
                            }, 3000);
                        }, 1500);
                        // end

                        // l√° mai r∆°i
                        setTimeout(() => {
                            setInterval(createLeaf, 800);
                        }, 2000);
                        // end

                        // thi·ªáp 
                        setTimeout(() => {
                            openCard();
                        }, 2500 + 5000);
                        // end

                        playBG();
                    }, 1000);//1200
                }, 50);//50
            }, 1000);//2500
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const isMobile = /Android|iPhone|iPad/i.test(navigator.userAgent);
            if (!isMobile) {
                console.log("PC detected ‚Üí start intro");
                startIntro();
            }
        });
    </script>

    <script>
        function hexToRgb(hex) {
            hex = hex.replace("#", "");
            const bigint = parseInt(hex, 16);
            return {
                r: (bigint >> 16) & 255,
                g: (bigint >> 8) & 255,
                b: bigint & 255
            };
        }
        const fullscreenBtn = document.getElementById('fullscreenBtn');

        function isFullscreen() {
            return document.fullscreenElement !== null;
        }

        function updateFullscreenButton() {
            fullscreenBtn.textContent = isFullscreen()
                ? 'Tho√°t to√†n m√†n h√¨nh'
                : 'To√†n m√†n h√¨nh';
        }

        // B·∫•m n√∫t
        fullscreenBtn.addEventListener('click', () => {
            if (!isFullscreen()) {
                document.documentElement.requestFullscreen().catch(() => { });
            } else {
                document.exitFullscreen();
            }
        });

        // L·∫Øng nghe thay ƒë·ªïi fullscreen (ESC, gesture, v.v.)
        document.addEventListener('fullscreenchange', updateFullscreenButton);

        // C·∫≠p nh·∫≠t l·∫ßn ƒë·∫ßu
        updateFullscreenButton();
    </script>
    <button id="fullscreenBtn" aria-label="Fullscreen">‚õ∂</button>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const btn = document.getElementById('fullscreenBtn');

            function isFullscreen() {
                return document.fullscreenElement ||
                    document.webkitFullscreenElement;
            }

            function requestFS() {
                const el = document.documentElement;
                if (el.requestFullscreen) return el.requestFullscreen();
                if (el.webkitRequestFullscreen) return el.webkitRequestFullscreen();
            }

            function exitFS() {
                if (document.exitFullscreen) return document.exitFullscreen();
                if (document.webkitExitFullscreen) return document.webkitExitFullscreen();
            }

            function updateIcon() {
                btn.textContent = isFullscreen() ? '‚§°' : '‚õ∂';
            }

            btn.addEventListener('click', () => {
                if (!isFullscreen()) {
                    requestFS();
                } else {
                    exitFS();
                }
            });

            document.addEventListener('fullscreenchange', updateIcon);
            document.addEventListener('webkitfullscreenchange', updateIcon);

            updateIcon();
        });
    </script>
    <div id="card-overlay">
        <div id="card-anchor">
            <div id="card">

                <button id="card-close">x</button>

                <div id="card-text-box">
                    <div id="card-text"></div>
                </div>

            </div>
        </div>
    </div>

    <div id="reopen-card-btn">
        <img src="https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/icon_thiep.png"
            alt="M·ªü l·∫°i thi·ªáp" />
    </div>

    <script>
        const wishText = `M√†y b·ªã t·∫≠t n√£o √† =))
        
test m·ªü l√¨ x√¨ v√† xem ·∫£nh
ƒë·∫∑t bi·ªát c√≥ lag gi·∫≠t kh√¥ng t gi·∫£m hi·ªáu ·ª©ng h·∫øt c·ªü r·ªìi ƒë√≥ üòÜü•πüòóü§°üòµ‚Äçüí´üòµ‚Äçüí´üôÉü•µüòÆ‚Äçüí®üòÆ‚Äçüí®‚ù§Ô∏èüß°üíõüíöü©µüíôüéäüíØüéâüíóüíìüíïüíåüíü‚ô•Ô∏è‚ù§Ô∏è‚Äçü©π‚ù§Ô∏è‚Äçüî•üíãü´Çüë•üë§üë§üß†ü´Äü´Åü¶†`;

        const overlay = document.getElementById("card-overlay");
        const anchor = document.getElementById("card-anchor");
        const card = document.getElementById("card");
        const cardText = document.getElementById("card-text");
        const closeBtn = document.getElementById("card-close");
        const reopenBtn = document.getElementById("reopen-card-btn");

        let typedIndex = 0;          // ƒë√£ g√µ t·ªõi k√Ω t·ª± n√†o
        let typingRunning = false;  // ƒëang g√µ hay kh√¥ng
        let typingDone = false;     // ƒë√£ g√µ xong to√†n b·ªô ch∆∞a

        reopenBtn.addEventListener("click", () => {
            openCard();
        });


        let cardImageReady = false;

        function loadCardImage() {
            return new Promise((resolve) => {
                if (cardImageReady) {
                    resolve();
                    return;
                }

                const img = new Image();
                img.src = "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/thiep.png";

                img.onload = () => {
                    card.style.backgroundImage = `url(${img.src})`;
                    cardImageReady = true;
                    resolve();
                };

                img.onerror = () => {
                    console.warn("Kh√¥ng load ƒë∆∞·ª£c ·∫£nh thi·ªáp");
                    resolve();
                };
            });
        }

        function openCard() {
            if (!cardImageReady) return; // ‚õî ch∆∞a load xong th√¨ kh√¥ng m·ªü

            reopenBtn.classList.remove("show");

            overlay.style.opacity = "1";
            overlay.style.pointerEvents = "auto";

            setTimeout(() => {
                anchor.style.opacity = 1;
                anchor.style.transform = "translate(-50%, -50%)";
                card.style.opacity = 1;
                card.style.transform = "translateY(0)"; // ‚≠ê D√íNG C√íN THI·∫æU
            }, 120);

            setTimeout(() => {
                if (!typingDone) {
                    typeText(cardText, wishText, 45);
                }

            }, 800);
        }

        closeBtn.onclick = () => {
            card.style.opacity = 0;
            card.style.transform = "translateY(20px)";
            anchor.style.opacity = 0;
            anchor.style.transform = "translate(-50%, -40%)";

            overlay.style.opacity = "0";
            overlay.style.pointerEvents = "none";

            reopenBtn.classList.add("show");
        };


        function typeText(element, text, speed = 70) {
            if (typingRunning) return; // ‚õî ch·∫∑n ch·∫°y tr√πng
            typingRunning = true;

            const chars = Array.from(text);
            const box = element.parentElement;

            function typing() {
                if (typedIndex >= chars.length) {
                    typingRunning = false;
                    typingDone = true;
                    return;
                }

                const ch = chars[typedIndex];

                if (ch === "\n") {
                    element.appendChild(document.createElement("br"));
                    typedIndex++;
                    typing();
                    return;
                }

                const span = document.createElement("span");
                span.textContent = ch;

                span.style.display = "inline-block";
                span.style.transform = "translateY(6px)";
                span.style.opacity = "0";
                span.style.transition = "transform 0.25s ease, opacity 0.25s ease";

                element.appendChild(span);

                box.scrollTo({
                    top: box.scrollHeight,
                    behavior: "smooth"
                });

                requestAnimationFrame(() => {
                    span.style.transform = "translateY(0)";
                    span.style.opacity = "1";
                });

                typedIndex++;
                setTimeout(typing, speed);
            }

            typing();
        }
    </script>

    <script>
        const lixiImages = [
            "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/lixi1.png",
            "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/lixi2.png",
            "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/lixi3.png",
            "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/lixi4.png",
            "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/lixi5.png",
            "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/lixi6.png"
        ];

        const photoImages = [
            "https://raw.githubusercontent.com/tzydangyeu-cmd/Thunghiem/main/Anh/photo1.png",
            "https://raw.githubusercontent.com/tzydangyeu-cmd/Thunghiem/main/Anh/photo2.png",
            "https://raw.githubusercontent.com/tzydangyeu-cmd/Thunghiem/main/Anh/photo3.png",
            "https://raw.githubusercontent.com/tzydangyeu-cmd/Thunghiem/main/Anh/photo4.png",
            "https://raw.githubusercontent.com/tzydangyeu-cmd/Thunghiem/main/Anh/photo5.png",
        ];

        const photoCaptions = [
            "photo1 l√† ·∫£nh r·∫•t ƒë·∫πp ƒë·∫πp ƒë·∫πp ƒë·∫πp ƒë·∫πp ƒë·∫πp ƒë·∫πp ƒë·∫πp ƒë·∫πp ƒë·∫πp ƒë·∫πp ƒë·∫πp ƒë·∫πp ƒë·∫πp ƒë·∫πp ƒë·∫πp ",
            "photo2   ü§£ ü•≤ ü§® üòà üíÄ üíÄ ü§´ ü§´ ü§´ ü§´",
            "photo3",
            "photo4",
            "photo5",
        ];

        // C·∫•u h√¨nh t·ªâ l·ªá xu·∫•t hi·ªán (Tr·ªçng s·ªë)
        // S·ªë c√†ng l·ªõn = T·ªâ l·ªá ra c√†ng cao
        const moneyWeights = [
            { url: "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/1k.png", weight: 1 },
            { url: "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/2k.png", weight: 1 },
            { url: "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/5k.png", weight: 1 },
            { url: "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/10k.png", weight: 1 },
            { url: "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/20k.png", weight: 1 },
            { url: "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/50k.png", weight: 1 },
            { url: "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/100k.png", weight: 1 },
            { url: "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/200k.png", weight: 1 },
            { url: "https://raw.githubusercontent.com/ngotranhoangthinhhtk8c-cmd/Dip_tet_nguyen_dan/main/Anh_he_thong/500k.png", weight: 1 }
        ];

        function randomMoney() {
            // 1. T√≠nh t·ªïng tr·ªçng s·ªë
            const totalWeight = moneyWeights.reduce((sum, item) => sum + item.weight, 0);

            // 2. Ch·ªçn m·ªôt s·ªë ng·∫´u nhi√™n t·ª´ 0 ƒë·∫øn t·ªïng tr·ªçng s·ªë
            let randomNum = Math.random() * totalWeight;

            // 3. Duy·ªát qua m·∫£ng ƒë·ªÉ t√¨m t·ªù ti·ªÅn t∆∞∆°ng ·ª©ng
            for (const item of moneyWeights) {
                if (randomNum < item.weight) {
                    return item.url;
                }
                randomNum -= item.weight;
            }
            return moneyWeights[0].url; // M·∫∑c ƒë·ªãnh tr·∫£ v·ªÅ t·ªù ƒë·∫ßu ti√™n n·∫øu c√≥ l·ªói
        }



        const tetEmojis = [
            "üå∏", // hoa ƒë√†o
            "üåº", // hoa mai
            "üíÆ", // hoa tr·∫Øng Nh·∫≠t (r·∫•t T·∫øt)
            "ü™∑", // sen
            "üåπ", // hoa h·ªìng
            "üéä", // confetti
            "üéâ", // ph√°o gi·∫•y
            "‚ú®", // l·∫•p l√°nh
            "üíñ"  // kh√¥ng kh√≠ vui v·∫ª
        ];


        function random(min, max) {
            return Math.random() * (max - min) + min;
        }



        function createFallingEmoji() {
            const wrapper = document.createElement("div");
            wrapper.className = "fall-emoji";

            const inner = document.createElement("div");
            inner.className = "emoji-spin";
            inner.textContent = tetEmojis[Math.floor(Math.random() * tetEmojis.length)];

            wrapper.style.left = Math.random() * 100 + "vw";

            const duration = Math.random() * 10 + 12;
            wrapper.style.animationDuration = `${duration}s, 4s`;
            inner.style.animationDuration = `${Math.random() * 6 + 6}s`;

            wrapper.appendChild(inner);
            document.body.appendChild(wrapper);

            setTimeout(() => wrapper.remove(), duration * 1000);
        }

        function createFallingLixi(imgUrl) {
            const wrapper = document.createElement("div");
            wrapper.className = "fall-lixi";

            const inner = document.createElement("div");
            inner.className = "lixi-spin";
            inner.style.backgroundImage = `url(${imgUrl})`;
            inner.style.cursor = "pointer";

            // L·∫•y t·ª∑ l·ªá ·∫£nh th·∫≠t ƒë·ªÉ kh√¥ng b·ªã c·∫Øt vu√¥ng
            const tempImg = new Image();
            tempImg.src = imgUrl;
            tempImg.onload = () => {
                const ratio = tempImg.width / tempImg.height;
                // Gi·ªØ nguy√™n chi·ªÅu r·ªông (lixi-size), t·ª± ƒëi·ªÅu ch·ªânh chi·ªÅu cao theo t·ª∑ l·ªá
                wrapper.style.height = `calc(var(--lixi-size) / ${ratio})`;
            };

            wrapper.style.left = Math.random() * 100 + "vw";

            const duration = Math.random() * 10 + 14;
            wrapper.style.animationDuration = `${duration}s, 4s`;
            inner.style.animationDuration = `${Math.random() * 6 + 6}s`;

            inner.addEventListener("click", (e) => {
                e.stopPropagation();
                wrapper.remove();
                openLixiPopup(imgUrl);
            });

            wrapper.appendChild(inner);
            document.body.appendChild(wrapper);

            setTimeout(() => {
                if (wrapper.parentNode) wrapper.remove();
            }, duration * 1000);
        }

        const photoOverlay = document.getElementById('photo-overlay');
        let activePhoto = null;
        let originalData = {}; // L∆∞u v·ªã tr√≠ g·ªëc

        function createFallingItem(type, imgUrl) {
            const item = document.createElement("div");
            item.classList.add("fall-item");

            if (type === "photo") {
                item.classList.add("fall-photo");
                item.style.pointerEvents = "auto";
                item.style.backgroundImage = `url(${imgUrl})`;

                const tempImg = new Image();
                tempImg.src = imgUrl;
                tempImg.onload = () => {
                    const ratio = tempImg.width / tempImg.height;
                    const widthVal = item.offsetWidth || 100;
                    item.style.height = (widthVal / ratio) + "px";
                };
            }

            item.style.left = Math.random() * 100 + "vw";
            const duration = random(
                parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--fall-duration-min")),
                parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--fall-duration-max"))
            );

            const swayDuration = random(3, 6);
            item.style.animationDuration = `${duration}s, ${swayDuration}s`;

            // --- PH·∫¶N 1: QU·∫¢N L√ù TH·ªúI GIAN X√ìA (TIMEOUT) ---
            // Ch√∫ng ta l∆∞u c√°i "l·ªánh x√≥a" n√†y v√†o m·ªôt bi·∫øn ƒë·ªÉ sau n√†y c√≥ th·ªÉ h·ªßy n√≥ ƒëi
            const removeTimeout = setTimeout(() => {
                if (!item.classList.contains('viewing') && item.parentNode) {
                    item.remove();
                }
            }, duration * 1000);

            // L∆∞u ID c·ªßa l·ªánh x√≥a v√†o thu·ªôc t√≠nh c·ªßa ·∫£nh
            item.dataset.timeoutId = removeTimeout;
            // ----------------------------------------------

            if (type === "photo") {
                item.onclick = (e) => {
                    e.stopPropagation();
                    if (activePhoto) return;

                    activePhoto = item;
                    const rect = item.getBoundingClientRect();
                    const photoIndex = photoImages.indexOf(imgUrl);
                    const captionBox = document.getElementById('photo-caption-box');
                    const captionText = document.getElementById('caption-text');

                    originalData = {
                        left: item.style.left,
                        top: rect.top + "px",
                        width: rect.width + "px",
                        height: rect.height + "px",
                        fallDuration: item.style.animationDuration
                    };

                    item.style.position = "fixed";
                    item.style.left = rect.left + "px";
                    item.style.top = rect.top + "px";
                    item.style.width = rect.width + "px";
                    item.style.height = rect.height + "px";
                    item.style.animation = "none";
                    item.style.zIndex = "100002";

                    requestAnimationFrame(() => {
                        requestAnimationFrame(() => {
                            photoOverlay.classList.add('show');
                            item.classList.add('viewing');
                            item.style.left = "30%";
                            item.style.top = "50%";
                            item.style.transform = "translate(-50%, -50%) scale(3.5)";

                            // Hi·ªán khung ch·ª©a ch·ªØ
                            captionBox.classList.remove('fading');
                            captionBox.classList.add('active');

                            // B·∫Øt ƒë·∫ßu g√µ ch·ªØ b·∫±ng h√†m ri√™ng
                            const textToType = photoCaptions[photoIndex] || "Ch√∫c m·ª´ng nƒÉm m·ªõi!";
                            const photoHint = document.getElementById('photo-hint'); // L·∫•y element h∆∞·ªõng d·∫´n c·ªßa ·∫£nh

                            // Reset h∆∞·ªõng d·∫´n v·ªÅ ·∫©n tr∆∞·ªõc khi g√µ ch·ªØ m·ªõi
                            if (photoHint) photoHint.style.opacity = "0";

                            typePhotoCaption(captionText, textToType, 45, () => {
                                // Callback n√†y ch·∫°y khi ch·ªØ ƒë√£ hi·ªán h·∫øt
                                if (photoHint) {
                                    photoHint.style.opacity = "1"; // Hi·ªán h∆∞·ªõng d·∫´n t·ª´ t·ª´ sang s√°ng
                                }
                            });
                        });
                    });
                };
            }

            document.body.appendChild(item);
        }

        // --- ƒêO·∫†N CODE T·ªêI ∆ØU ---
        photoOverlay.onclick = () => {
            if (!activePhoto) return;

            // --- PH·∫¶N M·ªöI: L√†m m·ªù ch·ªØ tr∆∞·ªõc ---
            const captionBox = document.getElementById('photo-caption-box');
            const photoHint = document.getElementById('photo-hint');
            if (photoHint) photoHint.style.opacity = "0";
            if (captionBox) {
                captionBox.classList.remove('active');
                captionBox.classList.add('fading');
            }
            

            const item = activePhoto;
            photoOverlay.classList.remove('show');

            if (item.dataset.timeoutId) {
                clearTimeout(parseInt(item.dataset.timeoutId));
            }

            // 1. Thu nh·ªè ·∫£nh v·ªÅ v·ªã tr√≠ c≈© b·∫±ng Transform (c·ª±c nh·∫π)
            item.style.transition = "all 0.4s ease-in-out";
            item.style.left = originalData.left;
            item.style.top = originalData.top;
            item.style.width = originalData.width;
            item.style.height = originalData.height;
            item.style.transform = "translate(0, 0) scale(1)";

            // 2. Khi v·ª´a thu nh·ªè xong, cho r∆°i ti·∫øp ngay l·∫≠p t·ª©c
            item.addEventListener('transitionend', function handler() {
                item.removeEventListener('transitionend', handler);

                item.classList.remove('viewing');
                item.style.zIndex = "4";

                // T√çNH TO√ÅN ƒê∆†N GI·∫¢N H√ìA:
                const currentY = parseFloat(item.style.top)
                const windowHeight = window.innerHeight;
                const remainingDist = windowHeight - currentY + 150;

                // Gi·∫£ ƒë·ªãnh t·ªëc ƒë·ªô r∆°i trung b√¨nh 100px/s (c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh s·ªë 100 n√†y)
                // ƒêi·ªÅu n√†y gi√∫p lo·∫°i b·ªè vi·ªác truy xu·∫•t getComputedStyle (m·ªôt h√†m g√¢y ch·∫≠m)
                const duration = remainingDist / 35;

                // 3. D√πng Transition ƒë·ªÉ r∆°i thay v√¨ Keyframes
                // S·ª≠ d·ª•ng cubic-bezier ƒë·ªÉ t·∫°o c·∫£m gi√°c r∆°i t·ª± nhi√™n (nhanh d·∫ßn m·ªôt ch√∫t)
                item.style.transition = `top ${duration}s linear`;

                // √âp tr√¨nh duy·ªát v·∫Ω l·∫°i (reflow) tr∆∞·ªõc khi g√°n top m·ªõi
                item.offsetHeight;

                item.style.top = (windowHeight + 200) + "px";

                // L·ªánh x√≥a cu·ªëi c√πng
                item.dataset.timeoutId = setTimeout(() => {
                    if (item.parentNode) item.remove();
                }, duration * 1000);

                activePhoto = null;
            }, { once: true });
        };

        function createMoneyRain(icons) {
            const rainCount = 30; // S·ªë l∆∞·ª£ng icon r∆°i xu·ªëng
            for (let i = 0; i < rainCount; i++) {
                setTimeout(() => {
                    const wrapper = document.createElement("div");
                    wrapper.className = "fall-emoji";
                    wrapper.style.zIndex = "10001"; // ƒê·∫£m b·∫£o hi·ªán tr√™n c·∫£ popup

                    const inner = document.createElement("div");
                    inner.className = "emoji-spin";
                    inner.textContent = icons[Math.floor(Math.random() * icons.length)];

                    wrapper.style.left = Math.random() * 100 + "vw";

                    // --- ƒê√É CH·ªàNH S·ª¨A T·∫†I ƒê√ÇY ---
                    // Thay ƒë·ªïi t·ª´ r∆°i nhanh (2-4s) sang r∆°i ch·∫≠m gi·ªëng m√†n h√¨nh ch√≠nh (12-22s)
                    const duration = Math.random() * 4 + 3;
                    wrapper.style.animationDuration = `${duration}s, 3s`; // 4s l√† t·ªëc ƒë·ªô l·∫Øc ngang (sway)
                    inner.style.animationDuration = `${Math.random() * 6 + 6}s`; // T·ªëc ƒë·ªô xoay c·ªßa icon
                    // ----------------------------

                    wrapper.appendChild(inner);
                    document.body.appendChild(wrapper);

                    setTimeout(() => wrapper.remove(), duration * 1000);
                }, i * 40); // TƒÉng gi√£n c√°ch gi·ªØa c√°c icon m·ªôt ch√∫t ƒë·ªÉ kh√¥ng b·ªã d·ªìn c·ª•c (t·ª´ 100 l√™n 200)
            }
        }



        function openLixiPopup(selectedLixiUrl) {
            let canClose = false;

            const overlay = document.createElement("div");
            overlay.style.cssText = `position:fixed; inset:0; background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; z-index:10000; opacity:1; transition: opacity 0.3s ease;`;

            const flash = document.createElement("div");
            flash.className = "flash-white";
            document.body.appendChild(flash);

            const hint = document.createElement("div");
            hint.className = "tap-hint";
            hint.textContent = "* Nh·∫•n v√†o m√†n h√¨nh ƒë·ªÉ ti·∫øp t·ª•c *";
            document.body.appendChild(hint);

            const popup = document.createElement("div");
            popup.style.cssText = `position:relative; display:flex; align-items:center; justify-content:center; width:100%; height:100%;`;

            const lixiImg = document.createElement("img");
            lixiImg.src = selectedLixiUrl;
            lixiImg.style.cssText = `max-height:45vh; z-index: 5; position: relative; transition: all 0.5s ease;`;
            lixiImg.style.animation = "superVibrate 2s cubic-bezier(.42, 0, 1, 1) forwards";

            const selectedMoneyUrl = randomMoney(); // G·ªçi h√†m t√≠nh t·ªâ l·ªá b·∫°n ƒë√£ vi·∫øt
            const moneyImg = document.createElement("img");
            moneyImg.src = selectedMoneyUrl;

            // ƒê·ªÉ l·∫•y ƒë∆∞·ª£c rainIcons (bi·ªÉu t∆∞·ª£ng r∆°i k√®m theo), ta c·∫ßn t√¨m l·∫°i object trong m·∫£ng
            const moneyData = moneyWeights.find(item => item.url === selectedMoneyUrl) || moneyWeights[0];

            // Logic x√°c ƒë·ªãnh icon theo URL ·∫£nh (m·ªánh gi√°)
            let rainIcons = ["üßß"];
            if (moneyData.url.includes("1k.png")) rainIcons = ["üí©", "ü§£"];
            else if (moneyData.url.includes("2k.png")) rainIcons = ["üí©", "üòÜ"];
            else if (moneyData.url.includes("5k.png")) rainIcons = ["üí©", "üòó"];
            else if (moneyData.url.includes("10k.png")) rainIcons = ["üòù"];
            else if (moneyData.url.includes("20k.png")) rainIcons = ["üòä"];
            else if (moneyData.url.includes("50k.png")) rainIcons = ["üåπ"];
            else if (moneyData.url.includes("100k.png")) rainIcons = ["üòç"];
            else if (moneyData.url.includes("200k.png")) rainIcons = ["üòØ", "ü§©"];
            else if (moneyData.url.includes("500k.png")) rainIcons = ["ü•≥", "üéâ", "üéä", "ü§Ø", "üò±"];

            moneyImg.style.cssText = `position: absolute; width: 25vw; max-width: 500px; z-index: 50; opacity: 0; pointer-events: none; transform: scale(0.5); transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);`;

            popup.appendChild(lixiImg);
            popup.appendChild(moneyImg);
            overlay.appendChild(popup);
            document.body.appendChild(overlay);

            setTimeout(() => {
                flash.classList.add("flash-active");

                setTimeout(() => {
                    lixiImg.style.animation = "none";
                    moneyImg.style.opacity = "1";
                    moneyImg.style.transform = "scale(1)";

                    // K√≠ch ho·∫°t m∆∞a icon ngay khi ti·ªÅn hi·ªán ra!
                    createMoneyRain(rainIcons);
                }, 200);

                setTimeout(() => {
                    hint.style.opacity = "1";
                    canClose = true;
                }, 700);
            }, 2000);

            overlay.onclick = () => {
                if (!canClose) return;
                overlay.style.opacity = "0";
                flash.remove();
                hint.remove();
                setTimeout(() => overlay.remove(), 300);
            };
        }

        // H√†m g√µ ch·ªØ d√†nh ri√™ng cho ghi ch√∫ ·∫£nh ƒë·ªÉ tr√°nh xung ƒë·ªôt v·ªõi thi·ªáp
        // H√†m g√µ ch·ªØ d√†nh ri√™ng cho ghi ch√∫ ·∫£nh (ƒê√£ s·ª≠a l·ªói d√≠nh ch·ªØ)
        // C·∫≠p nh·∫≠t h√†m g√µ ch·ªØ ƒë·ªÉ bi·∫øt khi n√†o ho√†n t·∫•t
        function typePhotoCaption(element, text, speed = 50, onComplete) {
            element.innerHTML = "";
            const segments = text.split(/(\s+)/);
            let segmentIdx = 0;
            let charIdx = 0;
            let currentWordSpan = null;

            function typing() {
                const parentBox = document.getElementById('photo-caption-box');
                if (!parentBox || !parentBox.classList.contains('active')) return;

                if (segmentIdx < segments.length) {
                    const segment = segments[segmentIdx];

                    if (segment.trim() === "") {
                        if (segment.includes("\n")) {
                            element.appendChild(document.createElement("br"));
                        } else {
                            element.appendChild(document.createTextNode(" "));
                        }
                        segmentIdx++;
                        charIdx = 0;
                        currentWordSpan = null;
                        setTimeout(typing, speed);
                        return;
                    }

                    if (!currentWordSpan) {
                        currentWordSpan = document.createElement("span");
                        currentWordSpan.style.whiteSpace = "nowrap";
                        currentWordSpan.style.display = "inline-block";
                        element.appendChild(currentWordSpan);
                    }

                    const chars = Array.from(segment);
                    if (charIdx < chars.length) {
                        const ch = chars[charIdx];
                        const letter = document.createElement("span");
                        letter.textContent = ch;
                        letter.style.display = "inline-block";
                        letter.style.transform = "translateY(5px)";
                        letter.style.opacity = "0";
                        letter.style.transition = "all 0.25s ease";

                        currentWordSpan.appendChild(letter);
                        requestAnimationFrame(() => {
                            letter.style.transform = "translateY(0)";
                            letter.style.opacity = "1";
                        });

                        charIdx++;
                        setTimeout(typing, speed);
                    } else {
                        segmentIdx++;
                        charIdx = 0;
                        currentWordSpan = null;
                        setTimeout(typing, speed);
                    }
                } else {
                    // QUAN TR·ªåNG: Khi ch·∫°y h·∫øt ch·ªØ th√¨ g·ªçi onComplete
                    if (typeof onComplete === "function") {
                        onComplete();
                    }
                }
            }
            typing();
        }

        let fallingStarted = false;
        let fallingInterval = null;

        function startFallingEffect() {
            if (fallingStarted) return; // ‚õî kh√¥ng cho ch·∫°y tr√πng
            fallingStarted = true;

            fallingInterval = setInterval(() => {
                const roll = Math.random();

                if (roll < 0.4) {
                    createFallingLixi(
                        lixiImages[Math.floor(Math.random() * lixiImages.length)]
                    );

                } else if (roll < 0.7) {
                    createFallingEmoji();
                } else {
                    createFallingItem(
                        "photo",
                        photoImages[Math.floor(Math.random() * photoImages.length)]
                    );
                }
            }, 1200);
        }
    </script>

</body>

</html>